
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    
    <title>Expression Builder</title>
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    
    <link rel="stylesheet" href="./modules/mathquill-0.10.1/mathquill.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="./modules/mathquill-0.10.1//mathquill.js"></script>
	  
    <link rel="stylesheet" href="./modules/styles/styles.css" />

    <style>
        #problemo {
            position: absolute;
            top: 50%;
            left: 50%;
            -ms-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
	    }
	#problem {
	    height: 100px;
  	    width: 500px; 
	    padding: 50px 0;
	    }

    </style>

    <py-env>
      - matplotlib
      - numpy
      - paths:
        - modules/class_Expression.py
    </py-env>
	  
    <script>
      var MQ = MathQuill.getInterface(2);
    </script>
	  
    <script>
    // (A) PASTE FROM CLIPBOARD
    function jspaste() {
      selection = document.getSelection();

      selectionString=selection.toString();
      alert("hi"+selectionString);
      answerMathField.write("");
      answerMathField.select();
      alert(answerMathField.latex());
      if (document.getSelection().length>0) {jpaste();}
    }
	    
    function insertHashAtPoint(e) {
	  let range;
	  let textNode;
	  let offset;

	  if (document.caretPositionFromPoint) {
	    range = document.caretPositionFromPoint(e.clientX, e.clientY);
	    textNode = range.offsetNode;
	    offset = range.offset;
	  } else if (document.caretRangeFromPoint) {
	    // Use WebKit-proprietary fallback method
	    range = document.caretRangeFromPoint(e.clientX, e.clientY);
	    textNode = range.startContainer;
	    offset = range.startOffset;
	  } else {
	    // Neither method is supported, do nothing
	    alert("caratPosition failed");
	    return;
	  }

	ansString=answerMathField.latex();
	alert(offset+ansString.slice(0, offset)+"#"+ansString.slice(-1*offset));
	}
	
	function insertHashAtPoint1(e) {

		var txt = answerMathField.latex();
		var len = txt.length;
		answerMathField.revert();
		var range = document.caretRangeFromPoint(e.clientX, e.clientY);
		os=range.startOffset;
		answerMathField = MQ.StaticMath(problemSpan);
		alert(os+txt.substring(0,os)+","+e.clientY+","+txt.substring(os,len));
	}


    </script>

  </head>
  <body >
    <h1>RENDER EXPRESSION</h1>
    <h4 id='date'>date here</h4>

    <div style="position: absolute;  right: 0px; margin: 30px;" width="100" >
	    <p><button type="button" id="new-expression-btn">New Expression</button></p>
	    <p></br></p>
	    <button type="button" id="add-btn">Add/Subtract</button></br>
	    <button type="button" id="multiply-btn">Multiply</button></br>
	    <button type="button" id="divide-btn">Divide</button></br>
            <p></br></p>
	    <p><label for="factor-input">By:</label></br>
            <input type="text" id="factor-input" placeholder="2x" /></p>
            <p></br></p>
	    <button type="button" id="show-btn">Show Expression</button></br>
	    <p id="print-tree">pre-wassup</p>
    </div>


	<p id="problemo" ><span id="problem" contenteditable="true">\frac{(x+2)}{y}</span></p>




	<script>
	  exp = [[0,"x",,],[2, "+", 0,1],[1,"2",,],[4, "*", 2,3],[3,"y",,]];
	  let problemSpan = document.getElementById('problem');
	  let answerMathField = MQ.MathField(problemSpan);
		
	  function set_answerMathField(text) {
		  answerMathField.latex(text);
	  }
		
	  set_answerMathField('(x+3)\\sqrt{y-1}');
		
	  let paragraphs = document.getElementsByTagName("p");
	  for (const paragraph of paragraphs) {
	    paragraph.addEventListener("mouseup", jspaste, false);
	   }
	</script>



	<script async src="./modules/index.js"></script>

    <py-script>


        import class_Expression as cex
        from pyodide import create_proxy, to_js
        import js
        import numpy as np
    
        numpart=0
        strpart=""
        exp_py=cex.Expression()
    

        exp_py.add_branch('+','x')
        exp_py.add_branch('+','2')
        exp_py.add_branch('*','y')   
        
        #js.document.getElementById("problem").select()
    </py-script>


  </body>

</html>
