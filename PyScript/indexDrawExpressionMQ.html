

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    
    <title>Expression Builder</title>
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    
    <link rel="stylesheet" href="./modules/mathquill-0.10.1/mathquill.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="./modules/mathquill-0.10.1//mathquill.js"></script>
	  
    <link rel="stylesheet" href="./modules/styles/styles.css" />

    <style>
        #problemo {
            position: absolute;
            top: 50%;
            left: 50%;
            -ms-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
	    }
	#problem {
	    height: 100px;
  	    width: 500px; 
	    padding: 50px 0;
	    }

    </style>

    <py-env>
      - matplotlib
      - numpy
      - paths:
        - modules/class_Expression.py
    </py-env>
	  
    <script>
      var MQ = MathQuill.getInterface(2);
    </script>
	  

  </head>
  <body >
    <h1>RENDER EXPRESSION</h1>
    <h4 id='date'>date here</h4>

    <div style="position: absolute;  right: 0px; margin: 30px;" width="100" >
	    <p><button type="button" id="new-expression-btn">New Expression</button></p>
	    <p></br></p>
	    <button type="button" id="add-btn">Add/Subtract</button></br>
	    <button type="button" id="multiply-btn">Multiply</button></br>
	    <button type="button" id="divide-btn">Divide</button></br>
            <p></br></p>
	    <p><label for="factor-input">By:</label></br>
            <input type="text" id="factor-input" placeholder="2x" /></p>
            <p></br></p>
	    <button type="button" id="show-btn">Show Expression</button></br>
	    <p id="print-tree">pre-wassup</p>
    </div>


	<p id="problemo" onmouseup="jspaste()" ><span id="problem" contenteditable="false">\frac{(x+2)}{y}</span></p>




	<script>
	  exp = [[0,"x",,],[2, "+", 0,1],[1,"2",,],[4, "*", 2,3],[3,"y",,]];
	  exp_result="";
	  exp_latex="";
	  selectedNodes=[];
	  let problemSpan = document.getElementById('problem');
	  let answerMathField = MQ.MathField(problemSpan);
		
	  function set_answerMathField(text) {
		  text=text.replace("'","");
		  text=text.replace("'","");
		  alert(text);
		  answerMathField.select();
		  answerMathField.clearSelection();
		  answerMathField.latex(text);
	  }
		
	  function get_exp1(obj) {
		  
		  objString=obj.toString();
		  arraystart=objString.indexOf("[[");
		  arrayend=objString.indexOf("]]");
		  objString=objString.substring(arraystart+1,arrayend+1).replaceAll("None","undefined");
		  eval("exp1=[" + objString + "]");
		  for (x1 in exp1) {
			  x1[0]=parseInt(x1[0]);
		  }
		  exp=exp1;
		}
	    
	   function get_printTree(obj) {
		  objString=obj.toString(); 
		  exp_result=objString.substring(objString.indexOf("['")+2,objString.indexOf("',"));
		  exp_latex=objString.substring(objString.indexOf(", '")+3,objString.indexOf("']"));
		  alert(exp_result);
		  alert(exp_latex);
	   	}
	    
	    // (A) PASTE FROM CLIPBOARD
	    function jspaste() {
		global selectedNodes;
		    
	      	selection = document.getSelection();
	      	selectionString=selection.toString();

	      	answerMathField.typedText("#");
		selection = answerMathField.latex();
	      	selectionString1 = selection.toString().substring(0,selection.toString().indexOf("#"));
		selectionString2 = selection.toString().substring(selection.toString().indexOf("#")+1,selection.toString().length);   
		    
		alert(selectionString1+";"+selectionString+";"+selectionString2);
		
		exp_result1=exp_result.replaceAll("(","");
		exp_result1=exp_result1.replaceAll(")","");
		exp_result1=exp_result1.replaceAll("!","");
		    
		selectionStringNo=1;
		    

		n=exp_result1.indexOf("]");
		alert(exp_result1);
		while (n>-1 && selectionStringNo==1) {
			operand=exp_result1[n+1];
			while ((exp_result1[n+2]>='0' && exp_result1[n+2]<='9') || (exp_result1[n+2]>='A' && exp_result1<='Z') || (exp_result1[n+2]>='a' && exp_result1<='z')) {
				operand+=exp_result1[n+2];
				n+=1;
			}
			exp_result1=exp_result1.substring(n+2);
			alert(operand);
			if (selectionString1.indexOf(operand)>=0) {
				selectionString1=selectionString1.substring(selectionString1.indexOf(operand)+operand.length);
			} else {selectionStringNo=0;}
			alert(selectionString1);
			n=exp_result1.indexOf("]");
		}


		n=exp_result1.indexOf("]");
		alert("hi");
		while (n>-1 && selectionStringNo==0) {
			index=parseInt(exp_result1.substring(exp_result1.substring(0,n).lastIndexOf("[")+1 ,n));
			selectedNodes.push(index);
			operand=exp_result1[n+1];
			while ((exp_result1[n+2]>='0' && exp_result1[n+2]<='9') || (exp_result1[n+2]>='A' && exp_result1<='Z') || (exp_result1[n+2]>='a' && exp_result1<='z')) {
				operand+=exp_result1[n+2];
				n+=1;
			}
			exp_result1=exp_result1.substring(n+2);
			n=exp_result1.indexOf("]");
			if (selectionString.indexOf(operand)>=0) {
				selectionString=selectionString.substring(selectionString.indexOf(operand)+operand.length);
			} else {selectionStringNo=2;}
		}

		alert(selectedNodes);
	      }
		
	</script>



	<script async src="./modules/index.js"></script>

	<py-script>
		
		import class_Expression as cex
		from pyodide import create_proxy, to_js
		import js
		import numpy as np

		numpart=0
		strpart=""
		exp_py=cex.Expression()


		exp_py.add_branch('+','x')
		exp_py.add_branch('+','2')
		exp_py.add_branch('*','y') 
		document.getElementById("factor-input").value=exp_py.print_tree('l')
		

		def show_expression(event):
			txt=document.getElementById("factor-input").value
			js.set_answerMathField(create_proxy(txt))
		
		def push_vars(event):
			js.get_exp1(create_proxy(exp_py.elements))
			js.get_printTree(create_proxy([exp_py.print_tree('r'), exp_py.print_tree('l')]))


		js.document.getElementById("show-btn").addEventListener("click", create_proxy(show_expression))
		js.document.getElementById("show-btn").addEventListener("click", create_proxy(push_vars))

	</py-script>


  </body>

</html>
