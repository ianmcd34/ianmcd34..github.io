


<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    
    <title>Equation Solver</title>
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    
    <link rel="stylesheet" href="./modules/mathquill-0.10.1/mathquill.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="./modules/mathquill-0.10.1//mathquill.js"></script>
	  
    <link rel="stylesheet" href="./modules/styles/styles.css" />

    <style>
        #problemo {
            position: absolute;
            top: 50%;
            left: 50%;
            -ms-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
	    }
	#problem {
	    height: 300px;
  	    width: 800px; 
	    padding: 50px 0;
	    }

    </style>

    <py-env>
      - matplotlib
      - numpy
      - paths:
        - modules/class_Expression.py
    </py-env>
	  
    <script>
      var MQ = MathQuill.getInterface(2);
    </script>
	  

  </head>
  <body >
    <h1>EQUATION SOLVER</h1>
    <h4 id='date'>date here</h4>

    <div style="position: absolute;  right: 0px; margin: 30px;" width="100" >
	    <p><button type="button" id="restart-btn">Restart</button></p>
	    <p><button type="button" id="clear-selection-btn">Clear Selection</button></p>
	    <p></br></p>
	    <button type="button" id="add-btn">Add/Subtract</button></br>
	    <button type="button" id="multiply-btn">Multiply</button></br>
	    <button type="button" id="divide-btn">Divide</button></br>
            <p></br></p>
	    <p><label for="factor-input">By:</label></br>
            <input type="text" id="factor-input" placeholder="2x" /></p>
            <p></br></p>
	    <button type="button" id="tidy-btn">Tidy Expression</button></br>
	    <button type="button" id="expand-btn">Expand Brackets</button></br>
	    <button type="button" id="factorise-btn">Factorise</button></br>
	    <button type="button" id="cancel-btn">Cancel</button></br>
	    <button type="button" id="add-constants-btn">Add Constants</button></br>
	    <button type="button" id="multiply-constants-btn">Multiply Constants</button></br>
	    <button type="button" id="add-expressions-btn">Add Expressions</button></br>
	    <button type="button" id="show-btn">Show Expression</button></br>
	    <p id="print-tree">pre-wassup</p>
    </div>


	<p id="problemo" onmouseup="jspaste()" onmouseenter="clear_answerMathField()"><span id="problem" contenteditable="false"></span></p>




	<script>

		expLeft=[[0,'0',,]]
		expRight=[[0,'0',,]]
		expLeft_result="";
	    expLeft_latex="";
		expRight_result="";
	    expRight_latex="";
		var selectedNodes=[];
		let problemSpan = document.getElementById('problem');
		let answerMathField = MQ.MathField(problemSpan);

		function clear_answerMathField() {
		  document.getElementById("clear-selection-btn").click();
	  	}

		function set_answerMathField(textL, textR) {

			textL=textL.replace("'","");
			textL=textL.replace("'","");
			textL=textL.replaceAll("\\\\","\\");

			textR=textR.replace("'","");
			textR=textR.replace("'","");
			textR=textR.replaceAll("\\\\","\\");

			answerMathField.select();
			answerMathField.clearSelection();

			answerMathField.latex(textL + " = " + textR);
			answerMathField.blur();
			selectedNodes=[];
		}

		function get_exp1(obj, side) {
		  
		  objString=obj.toString();
		  arraystart=objString.indexOf("[[");
		  arrayend=objString.indexOf("]]");
		  objString=objString.substring(arraystart+1,arrayend+1).replaceAll("None","undefined");
		  eval("exp1=[" + objString + "]");
		  for (x1 in exp1) {
			  x1[0]=parseInt(x1[0]);
		  }

		  if (side=='left')  {
		  	expLeft=exp1;
		  }
		  else{
		    expRight=exp1
		  }

		}
	  
		function get_printTree(obj, side) {
		  objString=obj.toString(); 
		  if (side=='left') {
			expLeft_result=objString.substring(objString.indexOf("['")+2,objString.indexOf("',"));
		    expLeft_latex=objString.substring(objString.indexOf(", '")+3,objString.indexOf("']"));
		  } else {
			expRight_result=objString.substring(objString.indexOf("['")+2,objString.indexOf("',"));
		    expRight_latex=objString.substring(objString.indexOf(", '")+3,objString.indexOf("']"));
		  }
		  
	   	}
		
	</script>



	<script async src="./modules/index.js"></script>

	<py-script>
		
		import class_Expression as cex
		from pyodide import create_proxy, to_js
		import js
		import numpy as np
		import re

		numpart=0
		strpart=""
		expLeft_py=cex.Expression()
		expRight_py=cex.Expression()

		def restart(event):
			global expLeft_py
			global expRight_py
			del expLeft_py
			del expRight_py

			expLeft_py.add_branch('+','x')
			expLeft_py.add_branch('+','2')
			expLeft_py.add_branch('*','y') 

			expRight_py.add_branch('+',3)

		def show_expression(event):
			txtL=expLeft_py.print_tree('l')
			txtR=expRight_py.print_tree('l')
			js.set_answerMathField(create_proxy(txtL, txtR))

		def push_vars(event):
			js.get_exp1(create_proxy(expLeft_py.elements), 'left')
			js.get_printTree(create_proxy([expLeft_py.print_tree('r'), expLeft_py.print_tree('l')]))

			js.get_exp1(create_proxy(expRight_py.elements), 'right')
			js.get_printTree(create_proxy([expRight_py.print_tree('r'), expRight_py.print_tree('l')]))

		
	

		js.document.getElementById("restart-btn").addEventListener("click", create_proxy(restart))
		js.document.getElementById("restart-btn").addEventListener("click", create_proxy(show_expression))
		js.document.getElementById("restart-btn").addEventListener("click", create_proxy(push_vars))
		js.document.getElementById("clear-selection-btn").addEventListener("click", create_proxy(show_expression))
		js.document.getElementById("clear-selection-btn").addEventListener("click", create_proxy(push_vars))


	</py-script>


  </body>

</html>
